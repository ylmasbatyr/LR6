# Лабораторная работа №5
## Методологии SAST и DAST. Триаж уязвимостей

**Выполнили:** Ульмашев Ислам, Духнай Николай
**Группа:** 21-К-АС2
**Дисциплина:** «Защита программного обеспечения защищенных автоматизированных систем»

---

### Цели работы
Практическое изучение и моделирование последовательных этапов кибератаки в соответствии с моделью Kill Chain в контролируемой лабораторной среде

### Ход работы
#### Этап 0. Подготовка
Были использованы две виртуальные машины: Windows 10 (x64), которая применялась для лабораторной работы №1 и Kali Linux (Live), которая применялась для лабораторной работы №5. В обеих машинах был включен сетевой мост вместо NAT и была проведена проверка доступа между ВМ. Команда ping показала, что машины успешно видят друг друга в сети. 

![](/source/2.jpg)

Изначально Linux не хотела видеть Windows, так как по умолчанию сеть определялась как "общественная", из-за чего пришлось отключить Windows Defender, Брэндмауэр и разрешить сетевое обнаружение.

![](/source/1.jpg)
![](/source/3.jpg)
![](/source/4.jpg)

#### Этап 1. Разведка
На этапе разведки была выполнена задача сбора первичной информации о целевой системе с использованием сканера сетевых служб nmap. Командой nmap -sV был произведён анализ хоста с IP-адресом 192.168.9.132, в результате чего удалось идентифицировать открытые порты и работающие на них службы. Были обнаружены ключевые порты Windows: 135/tcp (MSRPC), 139/tcp (NetBIOS) и, что наиболее важно, 445/tcp (SMB), предоставляющий прямой вектор для потенциальных атак. Эта информация стала основой для выбора метода дальнейшего проникновения в систему.

![](/source/5.jpg)

#### Этап 2. Создание оружия
На основе данных разведки был создан инструмент для проникновения — вредоносная полезная нагрузка. С помощью утилиты msfvenom из фреймворка Metasploit был сгенерирован исполняемый файл payload.exe. Полезная нагрузка windows/meterpreter/reverse_tcp была настроена на установление обратного TCP-соединения с атакующей машины (Kali Linux, 192.168.9.126) на порт 4444. В результате был получен файл размером 73 802 байта, который при запуске на целевой системе в фоновом режиме устанавливал бы сессию управления.

![](/source/6.jpg)

Также на этом этапе можно было сделать настройку скрипта, однако на деле этот шаг был исполнен уже после заражения машины.

![](/source/9.jpg)

#### Этап 3. Доставка
Для переноса созданного вредоносного файла на целевую машину Windows был использован метод доставки по сети. На атакующей машине Kali был запущен простой HTTP-сервер, который выступил в роли точки распространения. Файл был успешно загружен и сохранён на рабочем столе пользователя, имитируя типичный сценарий загрузки жертвой подложного вложения.

![](/source/7.jpg)

#### Этап 4. Эксплуатация
Критический этап эксплуатации начался с момента запуска файла payload.exe пользователем на целевой машине Windows 10. При запуске сработала встроенная система защиты Контроль учётных записей (UAC), которая запросила подтверждение на выполнение действий от имени администратора. В условиях лабораторной работы и симуляции успешной фишинговой атаки это предупреждение было сознательно проигнорировано, и был нажат вариант «Да». Это действие дало вредоносной программе необходимые привилегии для исполнения своего кода в системе.

![](/source/8.jpg)

#### Этап 5. Установка
Непосредственно после получения разрешения UAC полезная нагрузка payload.exe выполнила свой код в памяти системы. Вредоносная программа не производила постоянной записи на диск, а вместо этого установила в оперативную память интерактивную оболочку Meterpreter. Одновременно с этим на атакующей машине Kali, где заранее был запущен и настроен обработчик (multi/handler) в Metasploit, было зафиксировано входящее обратное соединение. В консоли Metasploit появилось подтверждение: «Meterpreter session 1 opened», что означало успешное проникновение и установку контроля над системой.


#### Этап 6.C2 (Командование)
После установки сессии была проверена работоспособность канала командования и управления (C2). В открывшейся интерактивной сессии Meterpreter были выполнены базовые команды для верификации доступа и сбора системной информации. Команда sysinfo отобразила детали целевой системы: имя компьютера DESKTOP-PD7VAHV, архитектуру x64 и версию ОС Windows 10 (10.0 Build 19045). Команда getuid показала, что вредоносный процесс выполняется от имени пользователя DESKTOP-PD7VAHV\ylmasbatyr, подтвердив уровень доступа и стабильность скрытого сетевого канала для удалённого управления. Также стоит отметить, что в диспетчере задач не отмечается подозрительный процесс payload.exe. 

![](/source/10.jpg)
![](/source/11.jpg)

#### Этап 7. Действия по цели
На финальном этапе были продемонстрированы действия, которые злоумышленник может предпринять после закрепления в системе. В рамках лабораторной работы была выполнена внутренняя разведка с помощью команды ps, которая вывела на атакующую машину полный список запущенных на цели процессов. Этот перечень, включающий системные службы (svchost.exe, lsass.exe) и пользовательские приложения, показывает, что злоумышленник получает возможность анализировать среду, искать конкретные программы (например, антивирус, браузеры с активными сессиями) или готовиться к латеральному перемещению по сети для достижения своих конечных целей, таких как кража конфиденциальных данных.

![](/source/12.jpg)
![](/source/13.jpg)
![](/source/15.jpg)

#### Противодействие каждому этапу
##### Противодействие этапу 1
Механизм противодействию представлен на фотографиях 4 и 5. Если сеть незащищена, то сетевое обнаружение обязательно нужно выключить и следить за тем, работает ли Брэндмауэр и Windows Defender.

##### Противодействие этапам 2-5
Следует отметить, что все действия на этапах 2-5 можно заблокировать благодаря инструментам антивирусной защиты и другим встроенным механизмам. Например, встроенный в ОС Windows 10 антивирусный софт Windows Defender блокирует выполнение процесса. Microsoft Edge предупреждает, что сайт без протокола HTTPS не является безопасным. Некоторые браузеры в целом не позволяют находится на нём.

##### Противодействие этапам 6-7
На этапе C2 (Командование и управление) ключевой контрмерой является мониторинг и фильтрация сетевого трафика. Необходимо настроить правила межсетевого экрана на блокировку исходящих соединений на нестандартные порты (такие как 4444, использованный в работе) и в недоверенные сетевые сегменты. Применение систем обнаружения вторжений (IDS) и систем предотвращения вторжений (IPS) позволяет выявлять шаблоны трафика, характерные для известных C2-фреймворков (например, Metasploit Meterpreter).

На этапе Действий по цели защита строится на принципах сегментации сети и контроля доступа. Даже при установленном C2-соединении злоумышленник должен быть ограничен в перемещении по сети и доступу к критическим данным. Внедрение решений класса DLP (Data Loss Prevention) предотвращает несанкционированную передачу конфиденциальной информации за пределы периметра. Не менее важны регулярное резервное копирование данных (для противодействия ransomware) и непрерывный мониторинг активности на конечных точках (Endpoint Detection and Response, EDR) для выявления аномальных действий, таких как массовое чтение или шифрование файлов, запуск подозрительных процессов (например, powershell с нехарактерными параметрами) или попытки эскалации привилегий.

![](/source/14.jpg)

### Ответы на вопросы
#### 1. Дайте определение модели Kill Chain (Цепочки уничтожения) в контексте кибербезопасности.
Это модель, описывающая этапы кибератаки от начала до конца

#### 2. Кто и с какой целью разработал классическую модель Cyber Kill Chain?
Изначально концепция была военной, но ее адаптировали для киберпространства компанией Lockheed Martin

#### 3. Перечислите все семь этапов классической модели Cyber Kill Chain по порядку.
Разведка, создание оружия, Доставка, Эксплуатация, Установка, Установление командования и управления, Действия по достижению цели

#### 4. Какова основная оборонительная идея модели Kill Chain?
Для каждого этапа Kill Chain можно разработать контрмеры

#### 5. На каком этапе Kill Chain происходит отправка фишингового письма?
Доставка

#### 6. Что такое этап "Установление командования и управления" (C2)? Почему он критически важен для злоумышленника?
Обеспечение связи с системой. Именно на этом этапе происходит командование ОС.

#### 7. Приведите пример контрмеры на этапе "Доставка".
Встроенная в браузер функция, блокирующая сразу переход на сайт с незащищённым протоколом HTTP

#### 8. Опишите сценарий атаки с использованием ransomware (шифровальщика) через призму этапов Kill Chain.
Злоумышленники проводят разведку, создают и упаковывают шифровальщик в легитимный файл, доставляют его через фишинговое письмо, эксплуатируют уязвимость для запуска, устанавливают вредоносное ПО в системе, устанавливают канал C2 для получения ключа шифрования и, наконец, выполняют шифрование файлов и вывод требований о выкупе.

#### 9. Почему этапы "Доставка" и "Эксплуатация" считаются одними из самых эффективных для обороны?
Это наиболее безопасные этапы в случае, если они провалились. В случае "доставки" файл можно удалить, а в случае эксплуатации файл может быть заблокирован дополнительными мерами. Скрыть трафик полностью невозможно, а уже запущенный процесс можно и не найти как в примере из ЛР.

#### 10. В чем заключаются основные ограничения и недостатки классической модели Cyber Kill Chain?
Линейность, плохо описывает инсайдерские угрозы, слабо освещает перемещение злоумышленника по сети, одна Kill Chain может быть лишь маленькой частью большой кампании.

#### 11. Объясните, как модель Kill Chain используется при расследовании киберинцидентов.
Kill Chain используется как структурная карта для реконструкции атак

#### 12. В чем разница между этапами "Эксплуатация" и "Установка"?
На этапе "Установка" KC не эксплуатирует, а на "Эксплуатация" установка уже прошла. Одно следствие из другого.

#### 13. Сравните этап "Разведка" в Kill Chain и тактику "Сбор информации" в модели MITRE ATT&CK. Что общего и в чем различие?
"Разведка" имеется в виду про разведку сети и устройства, а сбор данных происходит уже с заражённого устройства

#### 14. Как концепция "Обороны в глубину" (Defense in Depth) связана с моделью Kill Chain?
Она реализует принцип эшелонированной защиты, выстраивая специфические контрмеры для каждого этапа Kill Chain

#### 15. Почему инсайдерская угроза плохо описывается классической моделью Kill Chain? Приведите пример.
Пропускает несколько важных ступеней этой модели.
